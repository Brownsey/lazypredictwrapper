"0","#Age banding "
"0","data = data %>%"
"0","  mutate(age_band = if_else(EntryAge < 50, ""Less than 50"","
"0","                    if_else((EntryAge >= 50 & EntryAge < 60), ""Between 50 and 60"","
"0","                    if_else((EntryAge >= 60 & EntryAge < 65), ""Between 60 and 65"","
"0","                    if_else((EntryAge >= 65 & EntryAge < 70), ""Between 65 and 70"","
"0","                    if_else((EntryAge >= 70 & EntryAge < 75), ""Between 70 and 75"","
"0","                    if_else((EntryAge >= 75), ""Greater than 75"","
"0","                            ""Invalid Age"")))))))"
"0",""
"0","write_csv(data, ""data/km_data.csv"")"
"0",""
"0","# Loop through and create the graph data for each combination of age and sex"
"0","# Extract the time and surv properties of the model and use these for the line graph"
"0","for (i in sort(unique(data$age_band))){"
"0","  for (j in sort(unique(data$sex))){"
"0","    data2 = data %>%"
"0","      filter(age_band == i) %>%"
"0","      filter(sex == j)"
"0","    "
"0","    fit = survfit(Surv(time, death) ~ 1, data = data2, conf.type = ""none"")"
"0","    "
"0","    if(!exists(""graph_data"")){"
"0","      graph_data = tibble(fit$time, fit$surv) %>%"
"0","  rename(""time""=""fit$time"", ""alive"" = ""fit$surv"") %>%"
"0","  mutate(legend = paste(j, "" "" , i) )"
"0","      "
"0","    }"
"0","    else{"
"0","      "
"0","      graph_data1 = tibble(fit$time, fit$surv) %>%"
"0","  rename(""time""=""fit$time"", ""alive"" = ""fit$surv"") %>%"
"0","  mutate(legend = paste(j, "" "" , i) )"
"0","      "
"0","      graph_data = rbind(graph_data, graph_data1)"
"0","      "
"0","    }"
"0","    "
"0","  }"
"0","  "
"0","}"
"0",""
"0","#Plotting the graph"
"0","graph_data %>%"
"0","  ggplot(aes(x = time, y = alive, col = legend)) +"
"0","  geom_line() +"
"0","  theme_bw() +"
"0","  labs()"
