"0","#gompertz function"
"0","calc_gompertz <- function(x, eta, b){"
"0","  (1 - (exp(-eta*(exp(b*x) - 1))))"
"0","}"
"0",""
"0","#Just doing it for males and females "
"0","fit_f = survfit(Surv(time, death) ~ 1, data = data %>% filter(sex == ""Female""), conf.type = ""none"")"
"0","fit_m = survfit(Surv(time, death) ~ 1, data = data %>% filter(sex == ""Male""), conf.type = ""none"")"
"0",""
"0","#Create the df required for the graphing"
"0","create_deaths_df <- function(fit, legend){"
"0","  totals <- array()"
"0","  j = 0"
"0","  for (i in fit$n.event){"
"0","    j= i +j"
"0","    totals = append(totals, j)"
"0","  }"
"0","  totals = totals[!is.na(totals)]#First element was na - removing"
"0","  total = max(totals)"
"0","  "
"0","  df = tibble(fit$n.event, fit$time, fit$n.risk,totals) %>%"
"0","    rename(n_event = ""fit$n.event"", time =  ""fit$time"", risk = ""fit$n.risk"")"
"0","  "
"0","  "
"0","  df %>%"
"0","    mutate(legend = legend) %>%"
"0","    mutate(in_study = risk - totals) %>%"
"0","    mutate(cdf = totals/in_study) %>%"
"0","    mutate(cdf_deaths = totals/total) %>%"
"0","    #Had a little play with the values to see which looked somewhat respectable"
"0","    mutate(gompertz = calc_gompertz(time, 0.01, 0.005)) %>%"
"0","    mutate(gompertz_total = calc_gompertz(time, 0.003, 0.0025))"
"0","    "
"0","}"
"0",""
"0","gompertz_df_f = create_deaths_df(fit_f, ""Female"" )"
"0","gompertz_df_m = create_deaths_df(fit_m, ""Male"")"
"0",""
"0","#Some plots with gompertz added "
"0","gompertz_df_f %>%"
"0","  ggplot() +"
"0","  geom_line(aes(x = time, y = cdf_deaths, col = legend)) +"
"0","  geom_line(aes(x= time, y= gompertz)) +"
"0","  theme_bw() +"
"0","  labs(""Female CDF of deaths by time"")"
